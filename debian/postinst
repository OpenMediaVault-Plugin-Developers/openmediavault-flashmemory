#!/bin/sh

set -e

. /etc/default/openmediavault
. /usr/share/openmediavault/scripts/helper-functions

case "$1" in
    configure)
        # Activate package triggers
        dpkg-trigger update-workbench

        # create directories
        mkdir -p /opt/zram
        mkdir -p /usr/lib/zram-config
        mkdir -p /usr/local/share/zram-config/log

        # create log file
        touch /usr/local/share/zram-config/log/zram-config.log

        # create overlay and fsck.overlay symlinks
        ln -sf /usr/sbin/overlay.$(arch) /usr/sbin/overlay
        ln -sf /usr/sbin/fsck.overlay.$(arch) /usr/sbin/fsck.overlay

        # create config file
        omv-salt deploy run --no-color flashmemory
    ;;

    abort-upgrade|abort-remove|abort-deconfigure)
    ;;

    *)
        echo "postinst called with unknown argument" >&2
        exit 1
    ;;
esac

exit 0
